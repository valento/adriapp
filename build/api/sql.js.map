{"version":3,"sources":["../../server/api/sql.js"],"names":["SQL","url","table","fs","stat","err","res","db","SQLite","Database","console","log","init","message","prototype","serialize","run","q","prepare","params","$user_id","$email","$gender","$role","$lastlog","Date","now","$credit","$verified","finalize","locations","fetchOne","data","that","sql","Promise","resolve","reject","get","email","row","signUpUser","hash","first","last","mail","TypeError","$password","stm","changes","Error"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;AAEA,SAASA,GAAT,CAAaC,GAAb,EAAkBC,KAAlB,EAAyB;AAAA;;AACvB,MAAI;AACFC,iBAAGC,IAAH,CAAQH,GAAR,EAAa,UAACI,GAAD,EAAKC,GAAL,EAAa;AACxB,UAAGD,GAAH,EAAO;AACL,cAAMA,GAAN;AACD,OAFD,MAEO;AACL,cAAKE,EAAL,GAAU,IAAIC,iBAAOC,QAAX,CAAoBR,GAApB,EAAyB,eAAO;AACxC,cAAG,CAACI,GAAJ,EAASK,QAAQC,GAAR,CAAY,aAAZ;AACT,cAAGT,KAAH,EAAU;AACR,kBAAKU,IAAL,CAAUV,KAAV;AACD;AACF,SALS,CAAV;AAMD;AACF,KAXD;AAYD,GAbD,CAcA,OAAMG,GAAN,EAAW;AACTK,YAAQC,GAAR,CAAY,eAAeN,IAAIQ,OAA/B;AACD;AACF;;AAEDb,IAAIc,SAAJ,CAAcF,IAAd,GAAqB,UAASV,KAAT,EAAgB;AAAA;;AACnC,UAAOA,KAAP;AACE,SAAK,OAAL;AACA,WAAKK,EAAL,CAAQQ,SAAR,CACE,YAAM;AACJ,eAAKR,EAAL,CAAQS,GAAR,CAAY,uCACZ,uCADY,GAEZ,gCAFY,GAGZ,uCAHY,GAIZ,6BAJY,GAKZ,aALY,GAMZ,YANY,GAOZ,gBAPY,GAQZ,iBARY,GASZ,kBATY,GASQ;AACpB,iCAVY,GAUe;AAC3B,gCAXY,GAWc;AAC1B,gCAZY,GAaZ,+BAbY,GAaqB;AACjC,+BAdY,GAca;AACzB,6BAfY,GAgBZ,uBAhBY,GAiBZ,uBAjBY,GAiBa;AACzB,2BAlBY,GAkBS;AACrB,2BAnBY,GAmBS;AACrB,wBApBY,GAoBM;AAClB,sBArBY,GAqBI;AAChB,YAtBA;;AAwBF,YAAMC,IAAI,OAAKV,EAAL,CAAQW,OAAR,CAAgB,0EACV,yEADN,CAAV;AAEA,YAAMC,SAAS;AACbC,oBAAU,SADG;AAEbC,kBAAQ,4BAFK;AAGbC,mBAAS,CAHI;AAIbC,iBAAO,IAJM;AAKbC,oBAAUC,KAAKC,GAAL,EALG;AAMbC,mBAAS,GANI;AAObC,qBAAW;AAPE,SAAf;;AAUAX,UAAED,GAAF,CAAMG,MAAN;AACAF,UAAEY,QAAF;AACD;AACC;AAzCF;;AA4CA;AACA,SAAK,QAAL;AACE,WAAKtB,EAAL,CAAQS,GAAR,CAAY,wCACV,gBADU,GACQ;AAClB,sBAFU,GAEQ;AAClB,yBAHU,GAIV,gBAJU,GAKV,cALU,GAMV,IANF;AAOF;AAvDF;AAyDD,CA1DD;;AA4DAhB,IAAIc,SAAJ,CAAcgB,SAAd,GAA0B,UAAS5B,KAAT,EAAgB,CAEzC;AADC;;;AAGF;AAJA,CAKAF,IAAIc,SAAJ,CAAciB,QAAd,GAAyB,YAAoB;AAAA,MAAXC,IAAW,uEAAJ,EAAI;;AAC3CtB,UAAQC,GAAR,CAAYqB,IAAZ;AACA,MAAMC,OAAO,IAAb;AACA,MAAMC,uDAAN;AACA,SAAO,IAAIC,OAAJ,CAAa,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvCJ,SAAK1B,EAAL,CAAQ+B,GAAR,CAAYJ,GAAZ,EAAiB,CAAEF,KAAKO,KAAP,CAAjB,EAAiC,UAAClC,GAAD,EAAKmC,GAAL,EAAa;AAC5C,UAAGnC,GAAH,EAAO;AACLgC,eAAOhC,GAAP;AACD,OAFD,MAEO;AACT;AACI+B,gBAAQI,GAAR;AACD;AACF,KAPD;AAQD,GATM,CAAP;AAWD,CAfD;;AAiBA;AACAxC,IAAIc,SAAJ,CAAc2B,UAAd,GAA2B,UAAST,IAAT,EAAe;AAAA;;AACxCtB,UAAQC,GAAR,CAAYqB,KAAKU,IAAjB;AACA,MAAIC,QAAQ,MAAZ;AAAA,MACIC,OAAO,EADX;AAEA,MAAIZ,KAAKa,IAAL,KAAc,4BAAlB,EAAgD;AAC9CF,YAAQ,UAAR;AACAC,WAAO,SAAP;AACD,GAHD,MAGO,IAAIZ,KAAKa,IAAL,KAAc,0BAAlB,EAA8C;AACnDF,YAAQ,SAAR;AACAC,WAAO,OAAP;AACD;AACD,MAAMX,OAAO,IAAb;AACA,SAAO,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAoB;AACrC,QAAG,CAACL,IAAJ,EAAU;AACR,YAAM,IAAIc,SAAJ,CAAc,gCAAd,CAAN;AACD;AACD,QAAI7B,IAAI,yEACQ,iEADhB;AAEA,QAAIE,SAAS;AACXC,gBAAU,SADC;AAEXC,cAAQW,KAAKO,KAFF;AAGXQ,iBAAWf,KAAKU,IAHL;AAIXnB,aAAQS,KAAKO,KAAL,KAAe,4BAAf,IAA+CP,KAAKO,KAAL,KAAe,0BAA/D,GACP,IADO,GACA,IALI;AAMXZ,eAAUK,KAAKO,KAAL,KAAe,4BAAf,IAA+CP,KAAKO,KAAL,KAAe,0BAA/D,GACT,GADS,GACH,EAPK;AAQXX,iBAAW;AARA,KAAb;AAUA,QAAIoB,MAAMf,KAAK1B,EAAL,CAAQW,OAAR,CAAgBD,CAAhB,CAAV;AACA+B,QAAIhC,GAAJ,CAAQG,MAAR,EAAgB,eAAO;AACrB,UAAGd,GAAH,EAAO;AACL,YAAG,OAAK4C,OAAL,IAAgB,CAAnB,EAAsB;AACpBZ,iBAAO,IAAIa,KAAJ,CAAU,eAAV,CAAP;AACD;AACDb,eAAOhC,IAAIQ,OAAX;AACD,OALD,MAMK;AACHuB;AACD;AACF,KAVD;AAWD,GA5BM,CAAP;AA6BD,CAzCD;;kBA2CepC,G","file":"sql.js","sourcesContent":["import SQLite from 'sqlite3'\nimport fs from 'fs'\n\nfunction SQL(url, table) {\n  try {\n    fs.stat(url, (err,res) => {\n      if(err){\n        throw err\n      } else {\n        this.db = new SQLite.Database(url, err => {\n          if(!err) console.log('DB: Success')\n          if(table) {\n            this.init(table)\n          }\n        })\n      }\n    })\n  }\n  catch(err) {\n    console.log('Wrong DB: ' + err.message)\n  }\n}\n\nSQL.prototype.init = function(table) {\n  switch(table) {\n    case 'users' :\n    this.db.serialize(\n      () => {\n        this.db.run(\"CREATE TABLE if not exists users (\" +\n        \"user_id INTEGER PRIMARY KEY NOT NULL,\" +\n        \"email VARCHAR NOT NULL UNIQUE,\" +\n        \"password VARCHAR(12) NOT NULL UNIQUE,\" +\n        \"verified INTEGER DEFAULT 0,\" +\n        \"first TEXT,\" +\n        \"last TEXT,\" +\n        \"username TEXT,\" +\n        \"gender INTEGER,\" +\n        \"lastlog INTEGER,\" +// DATE: last login date to calculate rating/activitie\n        \"credit REAL default 10,\" +//20 initial, buy on PayPal\n        \"payment_metod INTEGER,\" +// default payment metod\n        \"rating REAL DEFAULT 0,\" +\n        \"role VARCHAR(4) default 1000,\" +//role access permissions\n        \"location VARCHAR(12),\" +// Lat,Lng\n        \"country VARCHAR(5),\" +\n        \"likes REAL DEFAULT 0,\" +\n        \"id_kickstart VARCHAR,\" +//access to LiveParty content\n        \"id_indie VARCHAR,\" +//access to LiveParty content\n        \"id_insta VARCHAR,\" +//passport-session\n        \"id_fb VARCHAR,\" +//passport-session\n        \"refs VARCHAR\" +// referential program ??: How To\n        \");\")\n\n      const q = this.db.prepare(\"INSERT INTO users (user_id, email,gender,role,lastlog,credit,verifed)\" +\n                      \"VALUES ($user_id, $email, $gender, $role, $lastlog, $credit, $verifyed)\")\n      const params = {\n        $user_id: 100000001,\n        $email: 'valentin.mundrov@gmail.com',\n        $gender: 1,\n        $role: 9999,\n        $lastlog: Date.now(),\n        $credit: 999,\n        $verified: true\n      }\n\n      q.run(params)\n      q.finalize()\n    }\n      //\n    )\n\n    break\n    case 'events' :\n      this.db.run(\"CREATE TABLE if not exists events (\" +\n        \"state INTEGER,\" +//(0=promo, 1=confirmed-comingup, 2=LiveNow!, 3=onKickstarter)\n        \"event VARCHAR,\" +//(for LIVE: Time included)\n        \"location VARCHAR,\" +\n        \"venue VARCHAR,\" +\n        \"time VARCHAR\" +\n        \");\")\n    break\n  }\n}\n\nSQL.prototype.locations = function(table) {\n  //\n}\n\n//Login Fetch User:\nSQL.prototype.fetchOne = function(data = []) {\n  console.log(data)\n  const that = this\n  const sql = `SELECT rowid, gender FROM users WHERE email = ?`\n  return new Promise ((resolve, reject) => {\n    that.db.get(sql, [ data.email ], (err,row) => {\n      if(err){\n        reject(err)\n      } else {\n    //sqlite returns rows = array\n        resolve(row)\n      }\n    })\n  })\n\n}\n\n// On Sign Up record --------------------------------------\nSQL.prototype.signUpUser = function(data) {\n  console.log(data.hash)\n  let first = 'Anon',\n      last = ''\n  if (data.mail === 'valentin.mundrov@gmail.com') {\n    first = 'valentin'\n    last = 'mundrov'\n  } else if (data.mail === 'iloveaquiles09@gmail.com') {\n    first = 'adriana'\n    last = 'perez'\n  }\n  const that = this\n  return new Promise((resolve,reject) => {\n    if(!data) {\n      throw new TypeError('Empty Object provided for Save')\n    }\n    let q = \"INSERT INTO users (user_id, email, password, role, credit, verifyed)\" +\n                    \"VALUES ($user_id, $email, $password, $role, $credit, $verifyed)\"\n    let params = {\n      $user_id: 100000001,\n      $email: data.email,\n      $password: data.hash,\n      $role: (data.email === 'valentin.mundrov@gmail.com' || data.email === 'iloveaquiles09@gmail.com') ?\n      9999 : 1000,\n      $credit: (data.email === 'valentin.mundrov@gmail.com' || data.email === 'iloveaquiles09@gmail.com') ?\n      999 : 10,\n      $verified: 0\n    }\n    let stm = that.db.prepare(q)\n    stm.run(params, err => {\n      if(err){\n        if(this.changes == 0) {\n          reject(new Error('Nothing saved'))\n        }\n        reject(err.message)\n      }\n      else {\n        resolve()\n      }\n    })\n  })\n}\n\nexport default SQL\n"]}