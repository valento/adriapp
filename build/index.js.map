{"version":3,"sources":["../server/index.js"],"names":["app","use","bodyParser","json","urlencoded","extended","lng","agent","PORT","process","env","ENV","NODE_ENV","console","log","ENTRY","wpConfig","require","MULTIENTRY","webpack","wpMiddle","wpHot","compiler","hot","express","static","path","join","__dirname","userRouter","authRouter","dataRouter","get","req","res","redirect","params","id","headers","split","match","lan","ln","markup","send","server","listen"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AAOA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;AAVA;AACA;AACA;AACA;;AASA,IAAIA,MAAM,wBAAV;;AAEA;AACAA,IAAIC,GAAJ,CAAQC,qBAAWC,IAAX,EAAR;AACAH,IAAIC,GAAJ,CAAQC,qBAAWE,UAAX,CAAsB,EAACC,UAAU,IAAX,EAAtB,CAAR;;AAEA,IAAIC,YAAJ;AAAA,IAASC,cAAT;AACA,IAAMC,OAAOC,QAAQC,GAAR,CAAYF,IAAZ,IAAoB,IAAjC;AACA,IAAMG,MAAMF,QAAQC,GAAR,CAAYE,QAAZ,IAAwB,aAApC;AACAC,QAAQC,GAAR,CAAYH,GAAZ;AACA,IAAMI,QAAQJ,QAAQ,YAAR,GAAuB,oBAAvB,GAA8C,sBAA5D;;AAEA,IAAGA,QAAQ,aAAX,EAAyB;AACzB;AACE,MAAMK,WAAWC,QAAQR,QAAQC,GAAR,CAAYQ,UAAZ,GAAyB,+BAAzB,GAA2D,oBAAnE,EAAyFP,GAAzF,CAAjB;AACA,MAAMQ,UAAUF,QAAQ,SAAR,CAAhB;AACA,MAAMG,WAAWH,QAAQ,wBAAR,CAAjB;AACA,MAAMI,QAAQJ,QAAQ,wBAAR,CAAd;AACA,MAAMK,WAAWH,QAAQH,QAAR,CAAjB;AACAhB,MAAIC,GAAJ,CAAQmB,SAASE,QAAT,EAAmB;AACzBC,SAAK;AADoB,GAAnB,CAAR;AAGAvB,MAAIC,GAAJ,CAAQoB,MAAMC,QAAN,CAAR;AACAtB,MAAIC,GAAJ,CAAQ,SAAR,EAAmBuB,kBAAQC,MAAR,CAAeC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,WAArB,CAAf,CAAnB;AACA5B,MAAIC,GAAJ,CAAQ,OAAR,EAAiBuB,kBAAQC,MAAR,CAAeC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,SAArB,CAAf,CAAjB;AACD,CAbD,MAaO;AACL;AACA5B,MAAIC,GAAJ,CAAQ,OAAR,EAAiBuB,kBAAQC,MAAR,CAAeC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,SAArB,CAAf,CAAjB;AACD;;AAED;AACA5B,IAAIC,GAAJ,CAAQ,OAAR,EAAiB4B,cAAjB;AACA;AACA7B,IAAIC,GAAJ,CAAQ,OAAR,EAAiB6B,cAAjB;AACA;AACA9B,IAAIC,GAAJ,CAAQ,OAAR,EAAiB8B,cAAjB;AACA;;AAEA/B,IAAIgC,GAAJ,CAAQ,qBAAR,EAA+B,UAACC,GAAD,EAAKC,GAAL,EAAa;AAC1CA,MAAIC,QAAJ,CAAa,GAAb,EAAkB,qCAAqC,SAArC,GAAiD,GAAjD,GAAuDF,IAAIG,MAAJ,CAAWC,EAApF;AACD,CAFD;AAGArC,IAAIgC,GAAJ,CAAQ,eAAR,EAAyB,UAACC,GAAD,EAAKC,GAAL,EAAa;AACpCA,MAAIC,QAAJ,CAAa,GAAb,EAAkB,qCAAqC,SAArC,GAAiD,GAAjD,GAAuDF,IAAIG,MAAJ,CAAWC,EAApF;AACD,CAFD;;AAIArC,IAAIgC,GAAJ,CAAQ,UAAR,EAAoB,UAACC,GAAD,EAAKC,GAAL,EAAa;AAC/B5B,QAAM2B,IAAIK,OAAJ,CAAY,iBAAZ,EAA+BC,KAA/B,CAAqC,GAArC,EAA0C,CAA1C,EAA6CA,KAA7C,CAAmD,GAAnD,EAAwD,CAAxD,CAAN;AACAhC,UAAS0B,IAAIK,OAAJ,CAAY,YAAZ,CAAD,CAA4BE,KAA5B,CAAkC,WAAlC,CAAR;AACA,MAAMC,MAAOnC,IAAIkC,KAAJ,CAAU,OAAV,CAAD,GAAsB,IAAtB,GAA6B,IAAzC;AACA,MAAMJ,SAAS;AACbM,QAAID,GADS;AAEb/B,SAAKC,GAFQ;AAGbJ,WAAOA;AAHM,GAAf;AAKA,MAAMoC,SAAS,2BAAYP,MAAZ,CAAf;AACAF,MAAIU,IAAJ,CAASD,MAAT;AACD,CAXD;;AAaA;AACA3C,IAAIgC,GAAJ,CAAQ,GAAR,EAAa,UAACC,GAAD,EAAKC,GAAL,EAAa;AACxB5B,QAAM2B,IAAIK,OAAJ,CAAY,iBAAZ,EAA+BC,KAA/B,CAAqC,GAArC,EAA0C,CAA1C,EAA6CA,KAA7C,CAAmD,GAAnD,EAAwD,CAAxD,CAAN;AACAhC,UAAS0B,IAAIK,OAAJ,CAAY,YAAZ,CAAD,CAA4BE,KAA5B,CAAkC,WAAlC,CAAR;AACA,MAAMC,MAAOnC,IAAIkC,KAAJ,CAAU,OAAV,CAAD,GAAsB,IAAtB,GAA6B,IAAzC;AACA,MAAMJ,SAAS;AACbM,QAAID,GADS;AAEb/B,SAAKC,GAFQ;AAGbJ,WAAOA;AAHM,GAAf;AAKA,MAAMoC,SAAS,wBAASP,MAAT,CAAf;AACAF,MAAIU,IAAJ,CAASD,MAAT;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEE;AACD,CA7BD;;AA+BA,IAAIE,SAAS7C,IAAI8C,MAAJ,CAAWtC,IAAX,EAAiB,YAAM;AAClCK,UAAQC,GAAR,CAAY,qBAAZ,EAAmCN,IAAnC;AACD,CAFY,CAAb","file":"index.js","sourcesContent":["import express from 'express'\nimport path from 'path'\nimport bodyParser from 'body-parser'\n\n//import React from 'react'\n//import { Provider } from 'react-redux'\n//import { renderToString } from 'react-dom/server'\n//import { StaticRouter } from 'react-router'\n\nimport userRouter from './routes/user'\nimport authRouter from './routes/auth'\nimport dataRouter from './routes/data'\n\nimport { template, tmp_present } from './template'\n/* -------------------------------------------------------------- */\n\nlet app = express()\n\n//const s3 = new S3({})\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({extended: true}))\n\nlet lng, agent\nconst PORT = process.env.PORT || 8000\nconst ENV = process.env.NODE_ENV || 'development'\nconsole.log(ENV)\nconst ENTRY = ENV === 'production' ? '../dist/index.html' : '../client/index.html'\n\nif(ENV === 'development'){\n/* ------ IN MEMORY bundle configuration ---------------------------- */\n  const wpConfig = require(process.env.MULTIENTRY ? '../webpack.conf.multientry.js' : '../webpack.conf.js')(ENV)\n  const webpack = require('webpack')\n  const wpMiddle = require('webpack-dev-middleware')\n  const wpHot = require('webpack-hot-middleware')\n  const compiler = webpack(wpConfig)\n  app.use(wpMiddle(compiler, {\n    hot: true\n  }))\n  app.use(wpHot(compiler))\n  app.use('/client', express.static(path.join(__dirname, '../client')))\n  app.use('/dist', express.static(path.join(__dirname, '../dist')))\n} else {\n  // PRODUCTION configuration\n  app.use('/dist', express.static(path.join(__dirname, '../dist')))\n}\n\n// ==== USER DATA ROUTES ==============================\napp.use('/user', userRouter)\n// ==== AUTHORIZATION ROUTES ==========================\napp.use('/auth', authRouter)\n// ==== TIMELINE ROUTES ===============================\napp.use('/data', dataRouter)\n// ----------------------------------------------------------\n\napp.get('/client/css/img/:id', (req,res) => {\n  res.redirect(301, '//s3.eu-central-1.amazonaws.com/' + 'adriapp' + '/' + req.params.id)\n})\napp.get('/dist/img/:id', (req,res) => {\n  res.redirect(301, '//s3.eu-central-1.amazonaws.com/' + 'adriapp' + '/' + req.params.id)\n})\n\napp.get('/present', (req,res) => {\n  lng = req.headers['accept-language'].split(',')[0].split('-')[0]\n  agent = (req.headers['user-agent']).match(/(Mobile)/g)\n  const lan = (lng.match(/^(es)/))? 'es' : 'en'\n  const params = {\n    ln: lan,\n    env: ENV,\n    agent: agent\n  }\n  const markup = tmp_present(params)\n  res.send(markup)\n})\n\n// === ENTRY Route ===========================================\napp.get('*', (req,res) => {\n  lng = req.headers['accept-language'].split(',')[0].split('-')[0]\n  agent = (req.headers['user-agent']).match(/(Mobile)/g)\n  const lan = (lng.match(/^(es)/))? 'es' : 'en'\n  const params = {\n    ln: lan,\n    env: ENV,\n    agent: agent\n  }\n  const markup = template(params)\n  res.send(markup)\n// --- SERVER Rendering ------------------------------------\n\n//  const store = {}\n//  const params = {\n//  entry: ENTRY\n//}\n//  const markup = renderToString(\n//    <Provider store={store}>\n//      <StaticRouter location={req.url}>\n//        <Route component={App} />\n//      </StaticRouter>\n//    </Provider>\n//  )\n//  const iState = {\n//    lan: lng\n//  }\n\n  //res.send(template(params, markup, iState))\n})\n\nlet server = app.listen(PORT, () => {\n  console.log('Server running on: ', PORT)\n})\n"]}